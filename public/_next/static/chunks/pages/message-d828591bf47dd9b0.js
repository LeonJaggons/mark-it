(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[728],{7084:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/message",function(){return s(3138)}])},3138:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return _}});var a=s(5893),n=s(8783),c=s(4292),r=s(7294),i=s(7877),l=s(9473),o=s(7747),u=s(3990),f=s(9993),g=s(6948),d=s(3090),x=s(1293),h=s(2757),m=s(4225),p=s(5460),j=s(1136),w=s(6121),I=s(5434),y=s(5922),v=s(3105),D=s.n(v);let b=()=>{let[e,t]=(0,r.useState)([]),[s,x]=(0,r.useState)(""),h=(0,l.v9)(e=>e.account.user),m=(0,l.v9)(e=>e.item.focusedMessage),p=async()=>{let e=await (0,i.rr)();t([...e])};(0,r.useEffect)(()=>{m&&p()},[m]);let j=async()=>{let a=D()(e[0].participants,e=>e!==h.userID)[0],n=e[0].itemID,c=await (0,i.bG)(a,n,s);t([...e,c]),x("")};return(0,a.jsx)(o.xu,{flex:1,h:"full",children:(0,a.jsx)(u.Z,{height:"full",w:"full",children:(0,a.jsxs)(n.g,{w:"full",h:"full",align:"flex-start",spacing:1,children:[(0,a.jsx)(o.xu,{p:4,w:"full",borderBottom:"1px solid rgba(0,0,0,.05)",children:(0,a.jsxs)(c.U,{align:"center",justify:"space-between",children:[(0,a.jsx)("span",{}),(0,a.jsx)(f.h,{icon:(0,a.jsx)(g.J,{as:I.xr$})})]})}),(0,a.jsx)(n.g,{w:"full",p:4,flex:1,overflowY:"scroll",maxH:"100vh",children:e.map(e=>(0,a.jsx)(S,{message:e}))}),(0,a.jsx)(o.xu,{p:4,w:"full",borderTop:"1px solid rgba(0,0,0,.05)",children:(0,a.jsxs)(c.U,{children:[(0,a.jsx)(d.I,{value:s,onChange:e=>x(e.target.value),variant:"unstyled",placeholder:"Type your message.."}),(0,a.jsx)(f.h,{variant:"ghost",colorScheme:"messenger",icon:(0,a.jsx)(g.J,{as:I.D6S}),onClick:j})]})})]})})})},S=e=>{let t=(0,l.v9)(e=>e.account.user),[s,n]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{n(t.userID===e.message.from)},[e.message,t]),(0,a.jsx)(c.U,{w:"full",justify:s?"flex-end":"flex-start",children:(0,a.jsx)(o.xu,{p:3,px:4,backgroundColor:s?"messenger.500":"gray.200",borderRadius:10,children:(0,a.jsx)(x.x,{color:s?"whiteAlpha.900":"black",children:e.message.content})})})},k=()=>{let[e,t]=(0,r.useState)([]),s=async()=>{let e=await (0,i.di)();t([...e])};return(0,r.useEffect)(()=>{s()},[]),(0,a.jsxs)(u.Z,{height:"full",padding:0,w:"300px",children:[(0,a.jsxs)(n.g,{w:"full",p:4,align:"flex-start",children:[(0,a.jsxs)(c.U,{justify:"space-between",w:"full",children:[(0,a.jsx)(h.X,{size:"md",children:"Messages"}),(0,a.jsx)(f.h,{icon:(0,a.jsx)(g.J,{as:I.xr$}),variant:"ghost"})]}),(0,a.jsx)(d.I,{})]}),(0,a.jsx)(n.g,{w:"full",spacing:1,p:2,children:e.map(e=>(0,a.jsx)(E,{message:e}))})]})},E=e=>{let[t,s]=(0,r.useState)(),i=(0,l.v9)(e=>e.item.focusedMessage),[u,f]=(0,r.useState)(!1),g=async()=>{let t=await (0,w.HA)(e.message.itemID);console.log(t),s({...t})},d=(0,l.v9)(e=>e.account.user),I=(0,l.I0)();return(0,r.useEffect)(()=>{g()},[]),(0,r.useEffect)(()=>{f(i&&i.to===e.message.to&&i.from===e.message.from&&i.itemID===e.message.itemID)},[i]),(0,a.jsx)(o.xu,{as:m.z,onClick:()=>{I((0,y.YU)(e.message))},colorScheme:"gray",color:"black",variant:"ghost",p:2,px:4,borderRadius:5,w:"full",display:"flex",h:"auto",background:u&&"messenger.50",children:t?(0,a.jsxs)(c.U,{flex:1,spacing:3,h:"60px",align:"center",children:[(0,a.jsx)(p.E,{src:t.images[0],w:"60px",objectFit:"cover",borderRadius:"30px",aspectRatio:1}),(0,a.jsxs)(n.g,{h:"full",justify:"center",align:"flex-start",spacing:0,children:[(0,a.jsx)(h.X,{size:"xs",children:t.title}),(0,a.jsx)(o.xu,{my:.5}),(0,a.jsxs)(x.x,{fontWeight:400,fontSize:13,children:[e.message.from===d.userID?"You: ":"",e.message.content]})]})]}):(0,a.jsx)(n.g,{h:"48px",children:(0,a.jsx)(j.$,{color:"gray.400"})})})};var _=()=>{let e=(0,l.v9)(e=>e.account.loggedIn),t=(0,l.v9)(e=>e.item.focusedMessage);return e?(0,a.jsx)(n.g,{paddingX:"7vw",paddingY:"18px",height:"full",w:"full",align:"flex-start",children:(0,a.jsxs)(c.U,{flex:1,w:"full",children:[(0,a.jsx)(k,{}),t&&(0,a.jsx)(b,{})]})}):(0,a.jsx)(a.Fragment,{})}},6121:function(e,t,s){"use strict";s.d(t,{$6:function(){return x},D3:function(){return f},HA:function(){return u},Nx:function(){return o},YI:function(){return d},lx:function(){return l},zo:function(){return g}});var a=s(4447);s(5922);var n=s(8216),c=s(6154),r=s(6100),i=s(6650);let l=async()=>{let e=n.h.getState().item.postItem,t={...e};n.h.getState().account.user;let s=t.images;for(let e of(delete t.images,console.log(t),Object.keys(t)))void 0===t[e]&&delete t[e];let c=(0,r.hJ)(a.DU,"item"),l=await (0,r.ET)(c,t).catch(e=>console.log(e));if(l){let e=l.id,t=[];if(s){let n=0;for(let c of s){n++;let s=(0,i.iH)(a.hr,"item/".concat(e,"/imgs/img-").concat(n,".jpg")),r=await fetch(c).catch(e=>console.log(e)),l=await r.blob(),o=await (0,i.KV)(s,l).catch(e=>console.log(e));if(o){let e=await (0,i.Jt)(o.ref);t.push(e)}}}await (0,r.r7)(l,{itemID:l.id,images:t})}},o=async()=>{let e=await c.Z.get("/api/item"),t=e.data;return t},u=async e=>{let t=await c.Z.get("/api/item?id=".concat(e));return t.data},f=async()=>{let e=n.h.getState().account.user.userID,t=await c.Z.get("api/favorite?userID=".concat(e));return t.data},g=async e=>{let t=await f();return null==t?void 0:t.map(e=>e.itemID).includes(e)},d=async e=>{let t=n.h.getState().account.user.userID;await c.Z.post("/api/favorite?itemID=".concat(e,"&userID=").concat(t))},x=async e=>{let t=n.h.getState().account.user.userID;await c.Z.delete("/api/favorite?itemID=".concat(e,"&userID=").concat(t))}},7877:function(e,t,s){"use strict";s.d(t,{bG:function(){return l},di:function(){return c},rr:function(){return r}});var a=s(8216),n=s(6154);let c=async()=>{let e=await i(),t=[];for(let s of e)if(0===t.length)t.push(s);else{let e=!1;for(let a of t)if(a.itemID==s.itemID&&a.participants.includes(s.to)&&a.participants.includes(s.from)){e=!0;break}e||t.push(s)}return console.log(t),t},r=async()=>{let{to:e,from:t,itemID:s}=a.h.getState().item.focusedMessage,c=await n.Z.get("/api/message?to=".concat(e,"&from=").concat(t,"&itemID=").concat(s));return console.log(c.data),c.data},i=async()=>{let e=a.h.getState().account.user.userID;console.log(e);let t=await n.Z.get("/api/message?userID=".concat(e));return console.log(t.data),t.data},l=async(e,t,s)=>{let c=a.h.getState().account.user.userID,r=await n.Z.post("/api/message?to=".concat(e,"&from=").concat(c,"&content=").concat(s,"&itemID=").concat(t));return r.data}}},function(e){e.O(0,[102,774,888,179],function(){return e(e.s=7084)}),_N_E=e.O()}]);